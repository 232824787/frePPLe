{% extends "admin/base_site_gridpivot.html" %}
{% load i18n %}

{% block extrahead %}{{block.super}} 
{% if args.0 %}<script type="text/javascript" src="{{STATIC_URL}}FusionCharts.js"></script>{% endif %}
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.sparkline.min.js"></script>
{% endblock %}

{% block contextmenus %}
{% include "resourcecontext.html" %}
{% include "locationcontext.html" %}
<div id="detailcontext" class="ContextMenu"><ul class="ui-menu ui-widget ui-widget-content ui-corner-all ui-state-default">
<li class="ui-menu-item"><a id="{{request.prefix}}/loadplan/?theresource={value}&amp;startdate__lt={enddate}&amp;enddate__gte={startdate}">{% trans 'Detail' %}</a></li>
<li class="ui-menu-item"><a id="{{request.prefix}}/resourcepegging/?theresource={value}&amp;startdate__lt={enddate}&amp;enddate__gte={startdate}">{% trans 'Pegging' %}</a></li>
</ul></div>
{% endblock %}

{% block tools %}{% if args.0 %}
{% include "resourcetabs.html" %}
{% endif %}{{block.super}}
{% endblock %}

{% block before_table %}
{% if args.0 %}<div id="chart1div" style="z-index: 1000;">
	  <p>&nbsp;</p>
	  <p>{% blocktrans %}frePPLe needs Adobe Flash Player to display graphs. If you're unable to see 
	  the chart here, it means that your browser does not seem to have the Flash Player 
	  installed.<br/>
	  You can downloaded it <a href="http://www.adobe.com/products/flashplayer/" target="_blank"><u>here</u></a> for free.{% endblocktrans %}</p>
	</div>
	<script language="javascript" type="text/javascript">
	   var chart1 = new FusionCharts("{{STATIC_URL}}FCF_StackedColumn2D.swf", "chart1", $(window).width()-35, 350);
	   chart1.setTransparent();
	   chart1.setDataURL(escape("{{request.prefix}}/resourcegraph/{{args.0|urlencode}}/?reportbucket={{reportbucket}}&reportstart={{reportstart|date:"Y-m-d"}}&reportend={{reportend|date:"Y-m-d"}}"));	   	   
	   chart1.render("chart1div");
	</script>
{% endif %}{% endblock %}

{% block crosses %}

function graph(cellvalue, options, rowdata) {
    var str = ['<span class="sparkline"><!--'];
    var cols = jQuery("#grid").jqGrid('getGridParam', 'colModel'); 
    var first = true; 
    for (var i in cols) {       
       if ('startdate' in cols[i]) {
          var data = rowdata[cols[i]['name']];
          var load = data[3];
          var delta = data[0] - data[2] - data[3];
          if (delta > 0) {
            free = Math.round(delta*10)/10;
            overload = 0;
          } else {
            free = 0;
            load = Math.round((data[0] - data[2])*10)/10;
            overload = -Math.round(delta*10)/10;
          }
          if (first) {
            str.push(data[1] + ':' + data[2] + ':' + load + ':' + free + ':' + overload);
            first = false;
          }
          else
            str.push(',' + data[1] + ':' + data[2] + ':' + load + ':' + + free + ':' + overload);
       }       
    }      
    str.push('--></span>');     
    return str.join('');
 };

function drawGraphs() {
  $('.sparkline').sparkline('html', { 
     type:'bar', disableHiddenCheck:true, 
     stackedBarColor:['#F6BD0F','#2B95EC','#AFD8F8','#8BBA00','#FF0000'], 
     width:'100px', height:'80px' 
     });
};  

function crosses (cellvalue, options, rowdata) {
  var result = cellvalue[0] + '<br/>' + cellvalue[1] + '<br/>' + cellvalue[2] + '<br/>';
  if (cellvalue[3] != 0.0)
    result += cellvalue[3] + "<span class='context cross ui-icon ui-icon-triangle-1-e' role='detail'></span><br/>";
  else
    result += '0.0<br/>';
  if (cellvalue[4] > 95)
    result += '<span class="highutil">' + cellvalue[4] + '%</span>';
  else
    result += cellvalue[4] + '%';
  return result;
};
{% endblock %}

{% block extra_grid %}gridComplete: drawGraphs,
{% endblock %}
