{% extends "admin/base_site_table.html" %}
{% load i18n %}

{% block extrahead %}{{ block.super }}
<script type="text/javascript">
    function onChange(input, old, start, end, units)
    {
    // Update the utilization percentage immediately
    var el = $(input).next('span');
    var unavailable = parseFloat(el.innerHTML);
    el = el.next('span');
    var a = el.down('a');
    if (a == undefined)
      var u = parseFloat(el.innerHTML);
    else
      var u = parseFloat(a.innerHTML);
    u /= parseFloat(input.value);
    if (isNaN(u) == true) u = 0.0;
    else u = u * 100;      
    el = el.next('span');
    el.innerHTML = u.round();
    if (u < 95)
      el.removeClassName('highutil');
    else
      el.addClassName('highutil');
    // Add the change
    if (old != 0) 
      u = parseFloat(input.value) * (1 + unavailable / old) / units;
    else
      u = parseFloat(input.value) / units; 
    upload.add({entity: 'resource.maximum',
      name: input.form.name,
      startdate: start,
      enddate: end,
      value: u});
    }
</script>
{% endblock %}

{% block contextmenus %}
{% include "resourcecontext.html" %}
{% include "locationcontext.html" %}
<div id="detailcontext" class="ContextMenu">
<a id="{{request.prefix}}/loadplan/%s">{% trans 'Detail' %}</a>
<a id="{{request.prefix}}/resourcepegging/%s">{% trans 'Pegging' %}</a>
</div>
{% endblock %}

{% block before_table %}
{% ifequal hits 1 %}<div id="chart1div" style="z-index: 1000;">
	  <p>&nbsp;</p>
	  <p>{% blocktrans %}frePPLe needs Adobe Flash Player to display graphs. If you're unable to see 
	  the chart here, it means that your browser does not seem to have the Flash Player 
	  installed.<br/>
	  You can downloaded it <a href="http://www.adobe.com/products/flashplayer/" target="_blank"><u>here</u></a> for free.{% endblocktrans %}</p>
	</div>
	<script language="javascript" type="text/javascript">
	   var totalAvailable = document.viewport.getDimensions();
	   var chart1 = new FusionCharts("/static/FCF_StackedColumn2D.swf", "sampleChart", totalAvailable.width-35, 350);
	   chart1.setTransparent();
	   chart1.setDataURL(escape("{{request.prefix}}/resourcegraph/{{object}}/?reportbucket={{reportbucket}}&reportstart={{reportstart}}&reportend={{reportend}}"));	   	   
	   chart1.render("chart1div");
	</script>
{% endifequal %}{% endblock %}

{% block frozendata %}{% for j in objectlist1 %}
<tr class="{% cycle row1,row2 %}">
<td>{% superlink j.name resource %}</td>
<td>{% if perms.input.change_location %}{% superlink j.location location %}{% else %}{{j.location}}{% endif %}</td>
<td>{{ crossheader }}</td>
</tr>{% endfor %}
{% endblock %}

{% block data %}
{% if perms.input.change_resource %}
{% for j in objectlist2 %}{% ifchanged j.resource %}{% if not forloop.first %}</form></tr>{% endif %}<tr class="{% cycle row1,row2 %}"><form name="{{j.resource|escape}}">{% endifchanged %}
<td><input type="text" value="{{j.available|floatformat:1}}" size="6" onchange="onChange(this, {{j.available}}, '{{j.startdate}}', '{{j.enddate}}', {{j.units}})"/><br/>
<span>{{j.unavailable|floatformat:1}}</span><br/>
{{j.setup|floatformat:1}}<br/>
<span>{% if j.load %}<a href="?theresource={{j.resource|urlencode}}&amp;startdate__lt={{j.enddate}}&amp;enddate__gte={{j.startdate}}" tabindex="-1" class="detail">{{j.load|floatformat:2}}</a>{% else %}0.00{% endif %}</span><br/>
<span{% if j.utilization > 95 %} class="highutil"{% endif %}>{{j.utilization|floatformat:0}}</span></td>
{% if forloop.last %}</form></tr>{% endif %}{% endfor %}
{% else %}
{% for j in objectlist2 %}{% ifchanged j.resource %}{% if not forloop.first %}</tr>{% endif %}<tr class="{% cycle row1,row2 %}">{% endifchanged %}
<td>{{j.available|floatformat:1}}<br/>
{{j.unavailable|floatformat:1}}<br/>
{{j.setup|floatformat:1}}<br/>
{% if j.load %}<a href="{{ request.prefix }}/loadplan/?theresource={{j.resource|urlencode}}&amp;startdate__lt={{j.enddate}}&amp;enddate__gte={{j.startdate}}">{{j.load|floatformat:2}}</a>{% else %}0.00{% endif %}<br/>
{{j.utilization|floatformat:0}}</td>
{% if forloop.last %}</tr>{% endif %}{% endfor %}
{% endif %}
{% endblock %}

{% block pagination %}{% ifnotequal hits 1 %}{{ block.super }}{% endifnotequal %}{% endblock %}
