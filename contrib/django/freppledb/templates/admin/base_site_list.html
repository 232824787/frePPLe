{% extends "admin/base_site_nav.html" %}
{% load i18n admin_list %}
{% block extrastyle %}{{ block.super }}<link rel="stylesheet" type="text/css" media="screen" href="/static/css/ui.jqgrid.css" />
{% endblock %}
{% block extrahead %}{{ block.super }} 
{% block extrajavascript %}<script type="text/javascript">
var original;
$(function(){ 

  jQuery("#jsonmap").jqGrid({        
   	url: window.location.href + (window.location.href.indexOf("?") == -1 ? "?format=json" : "&format=json"),
	  datatype: "json",
	  jsonReader : {id: "{{reportclass.keyfield}}", repeatitems:false},
   	colModel:[
   	  {% for f in reportclass.rows %}{% if not forloop.first %},
   	  {% endif %}{{f|safe}}{% endfor %}
   	  ],
    //cellEdit: true,
    //cellsubmit: 'clientArray',
    //editurl: location.pathname,
   	rowNum: 100,
   	pager: '#pjmap',
   	sortname: '{{reportclass.keyfield}}',
    viewrecords: true,    
    sortorder: "asc",	
    hidegrid: false,
    scrollRows: true,
	  altRows: true,
	  scroll: 1,
    autowidth: true,    
	  shrinkToFit: false,
	  height: $(window).height() - $("#jsonmap").offset().top - 70
    });
  
  jQuery("#jsonmap").jqGrid('navGrid','#pjmap',
    {edit:true,add:false,del:false,refresh:false},{},
    {},
    {},
    {multipleSearch:true, multipleGroup:true, showQuery: true}
    );
  });
/*
  $("#savebutton").click(function() {
    alert(JSON.stringify($("#jsonmap").getChangedCells('dirty')));
    });



$(window).bind('beforeunload', function() {
   var rows = $("#jsonmap").getChangedCells('dirty');
   alert(JSON.stringify(rows));
   if (rows != null && rows.length > 0) 
   {
     $("#popup").html("Discard saved data").dialog({ 
       title: gettext("Export data"), autoOpen: true, resizable: false,
       modal: true,
       buttons: 
          {
          "Save": function() {
            $( this ).dialog( "close" );
            return false;
            },
          "Discard": function() {
            $( this ).dialog( "close" );
            return true;
            }       
          }  
      });
      return true;
  };
  return true;
});
*/

$(window).bind('resize', function() {
  $("#jsonmap")
   .setGridWidth($('#content-main').width()) 
   .setGridHeight($(window).height() - $("#jsonmap").offset().top - 70);
}); 

</script> 
{% endblock %}
{% endblock %}
{% block coltype %}colM{% endblock %}
{% block tools %}<div class="tools">{{filternew}}{{hasaddperm}}
<a href="javascript:filter.show();" class="icon"><span class="ui-icon ui-icon-search"></span>{% trans 'Filter' %}</a>
{% if hasaddperm %}<a href="{{ request.prefix }}/admin/{{ model|app_label }}/{{ model|object_name|lower }}/add/{% if is_popup %}?_popup=1{% endif %}" class="icon"><span class="ui-icon ui-icon-plusthick"></span>{% trans 'Add' %}</a>{% endif %}
{% if hasaddperm and model %}<a href="javascript:import_show();" class="icon"><span class="ui-icon ui-icon-arrowreturnthick-1-s"></span>{% trans 'Import' %}</a>{% endif %}
<a href="javascript:export_show(true);" id="csvexport" class="icon"><span class="ui-icon ui-icon-arrowreturnthick-1-n"></span>{% trans 'Export' %}</a><div id="popup" class="ui-helper-hidden"></div>
<div id="popup"></div>

</div>{% endblock %}
{% block content %}
{% block contextmenus %}{% endblock %}
<div id="content-main" style="margin-right: 16px;">
{% block before_table %}{% endblock %}
<table id="jsonmap"></table>
<div id="pjmap"></div>
</div>
{% endblock %}
