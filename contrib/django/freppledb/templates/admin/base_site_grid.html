{% extends "admin/base_site_nav.html" %}
{% load i18n admin_list %}
{% block extrahead %}{{ block.super }} 
<script type="text/javascript">
$(function(){ 
  jQuery("#grid").jqGrid({        
   	url: window.location.href + (location.search.length > 0 ? "&format=json" : "?format=json"),
	  datatype: "json",
	  jsonReader : {repeatitems:false},
   	colModel:[{% if is_popup %}
      {name:'select',label:gettext('Select'),width:75,align:'center',sortable:false,search:false},
      {% endif %}{% for f in reportclass.rows %}{% if not forloop.first %},
   	  {% endif %}{ {{f|safe}}{% if forloop.counter <= reportclass.frozenColumns %}frozen:true,{% endif %}{% if is_popup %}popup:true{% endif %} }{% endfor %}   	  
   	  ],{% if reportclass.editable %}
    cellsubmit: 'clientArray',
    editurl: location.pathname,
   	{% endif %}rowNum: {{request.pagesize}},{% if is_popup %}
   	onSelectRow: setSelectedRow,{% endif %}
   	pager: '#gridpager',
    viewrecords: true,    
    sortorder: "asc",	
    hidegrid: false,
    scrollRows: true,
	  //altRows: true,  // Different color for alternating rows. But doesn't look nice with a lot of themes.
	  //scroll: 1,      // Enables scrolling over all records, instead of paging. But not compatible with frozen columns. 
	  //sortable: true, // Allows columns to be dragged and dropped between positions. But not compatible with frozen columns  
    autowidth: true,    
	  shrinkToFit: false,
	  height: $(window).height() - $("#grid").offset().top - 70
    });{% if reportclass.frozenColumns > 0 %}
  jQuery("#grid").jqGrid('setFrozenColumns');{% endif %} 
  // Initial search string:
  // jQuery('#grid').jqGrid('setGridParam', {postData: mypostdata, search:true});
  });
  
/*
  $("#savebutton").click(function() {
    alert(JSON.stringify($("#grid").getChangedCells('dirty')));
    });

$(window).bind('beforeunload', function() {
   var rows = $("#grid").getChangedCells('dirty');
   alert(JSON.stringify(rows));
   if (rows != null && rows.length > 0) 
   {
     $("#popup").html("Discard saved data").dialog({ 
       title: gettext("Export data"), autoOpen: true, resizable: false,
       modal: true,
       buttons: 
          {
          "Save": function() {
            $( this ).dialog( "close" );
            return false;
            },
          "Discard": function() {
            $( this ).dialog( "close" );
            return true;
            }       
          }  
      });
      return true;
  };
  return true;
});
*/

$(window).bind('resize', function() {
  $("#grid")
   .setGridWidth($('#content-main').width()) 
   .setGridHeight($(window).height() - $("#grid").offset().top - 70);
}); 

</script> 
{% endblock %}
{% block content_title %}{{ block.super }}{% endblock %}
{% block coltype %}colM{% endblock %}
{% block tools %}<div class="tools">
<a href="javascript:filter_show();" class="icon"><span class="ui-icon ui-icon-search"></span>{% trans 'Filter' %}</a>
{% if haschangeperm and not is_popup %}<a href="javascript:edit_show();" class="icon"><span class="ui-icon ui-icon-pencil"></span>{% trans 'Edit' %}</a>
{% endif %}{% if hasaddperm %}<a href="{{ request.prefix }}/admin/{{ model|app_label }}/{{ model|object_name|lower }}/add/{% if is_popup %}?_popup=1{% endif %}" class="icon"><span class="ui-icon ui-icon-plusthick"></span>{% trans 'Add' %}</a>
{% endif %}{% if hasaddperm %}<a href="javascript:import_show();" class="icon"><span class="ui-icon ui-icon-arrowreturnthick-1-s"></span>{% trans 'Import' %}</a>
{% endif %}<a href="javascript:export_show(true);" id="csvexport" class="icon"><span class="ui-icon ui-icon-arrowreturnthick-1-n"></span>{% trans 'Export' %}</a>
</div>{% endblock %}
{% block content %}
<div id="content-main" style="margin-right: 15px;">
{% block before_table %}{% endblock %}
<table id="grid"></table>
<div id="gridpager"></div>
{% block after_table %}{% endblock %}
</div>
{% block contextmenus %}{% endblock %}
{% endblock %}
