{% extends "admin/base_site_nav.html" %}
{% load i18n %}
{% block stylesheet %}{% load adminmedia %}{% admin_media_prefix %}css/dashboard.css{% endblock %}
{% block extrahead %}{{ block.super }}
<script type="text/javascript">
  function calcUtil()
  {
    var clusters = parseInt(document.getElementById("0").value);
    var fcst = parseInt(document.getElementById("1").value);
    var demands = parseInt(document.getElementById("2").value);
    var levels = parseInt(document.getElementById("3").value);
    var rsrc_number = parseInt(document.getElementById("4").value);
    var rsrc_size = parseInt(document.getElementById("5").value);
    // Available capacity:  rsrc_number * rsrc_size * 365 days/year
    // Required capacity: clusters * fcst * 12 months/day * 1 day/unit
    // Levels has no influence since we load a resource only at 1 step
    // Demands also has no influence, as we assume that the forecast quantity is bigger than the orders.
    var util = (clusters * fcst * 12) / (rsrc_number * rsrc_size * 365)
	  document.getElementById("util").innerHTML = (util * 100).toFixed(1);
  }
</script>

{% endblock %}
{% block coltype %}colM{% endblock %}
{% block bodyclass %}dashboard{% endblock %}
{% block content %}
<div id="content-main">

{% if perms.execute %}

{% if perms.execute.run_frepple %}
<div class="module">
<table summary="Extra commands.">
<caption>frePPLe</caption>

<form method="post" action="/execute/runfrepple/">
<tr><th scope="row"><a>Run frePPLe</a></th>
<td>Load frepple from the database...  <br/>
and create <select name="type" id="type">
<option value="7">constrained</option>
<option value="3">material constrained</option>
<option value="4">capacity constrained</option>
<option value="0">unconstrained</option>
</select> plan in frePPLe...<br/>
and export results into the database<br/><br/>
<a href="/execute/log/">View latest log file</a></td>
<td><input id="run_frepple" type="submit" value="Run" />
<input type="hidden" name="action" value="run" /></td>
</tr>
</form>

</table>
</div>
{% endif %}

{% if perms.execute.upload_csv %}
<div class="module">
<table summary="Extra commands.">
<caption>Upload data</caption>

<tr><th scope="row"><a>CSV</a></th>
<form enctype="multipart/form-data" method="post" action="/execute/upload/">
<td>Load data from a csv text file in the database.<br/>
The first row of your file should contain the field names.<br/>
Entity: <select name="entity" id="entity">
<option value="-" selected="selected">-</option>
<option value="Buffer">Buffer</option>
<option value="Calendar">Calendar</option>
<option value="Bucket">Calendar Bucket</option>
<option value="Customer">Customer</option>
<option value="Dates">Dates</option>
<option value="Demand">Demand</option>
<option value="Flow">Flow</option>
<option value="Forecast">Forecast</option>
<option value="ForecastDemand">Forecast Demand</option>
<option value="Item">Item</option>
<option value="Load">Load</option>
<option value="Location">Location</option>
<option value="Operation">Operation</option>
<option value="OperationPlan">OperationPlan</option>
<option value="Resource">Resource</option>
</select><br/>
Select your csv file: <input type="file" id="csv_file" size="23" name="csv_file"/><br/>
</td>
<td><input id="upload_button" type="submit" value="Upload"/></td>
</form></tr>

<tr><th scope="row"><a>Fixtures</a></th>
<form method="post" action="/execute/fixture/">
<td>Load a predefined dataset from a library.<br/>
Available datasets: <select name="datafile" id="entity">
<option value="-" selected="selected">-</option>
<option value="initial_data">Small demo dataset</option>
<option value="dates">Dates</option>
</select>
</td>
<td><input id="upload_button" type="submit" value="Load"/></td>
</form></tr>

</table>
</div>
{% endif %}

{% if perms.execute.run_db %}
<div class="module">
<table summary="Extra commands.">
<caption>Database</caption>
<tr><th scope="row"><a>Erase</a></th>
<form method="post" action="/execute/rundb/">
<td>Erase all data from the database.</td>
<td><input id="erase_db" type="submit" value="Run" />
<input type="hidden" name="action" value="erase" /></td>
</form></tr>
<tr><th scope="row"><a>Generate a model</a></th>
<form method="post" action="/execute/rundb/">
<td>Create a sample model in the database.<br/>
The parameters control the size and complexity.<br/>
Number of end items: <input id="0" name="clusters" type="text" maxlength="5" size="5" value="100" onchange="calcUtil()"/><br/>
Monthly forecast per end item: <input id="1" name="fcst" type="text" maxlength="4" size="4" value="50" onchange="calcUtil()"/><br/>
Demands per end item: <input id="2" name="demands" type="text" maxlength="4" size="4" value="40" onchange="calcUtil()"/><br/>
Depth of bill-of-material: <input id="3" name="levels" type="text" maxlength="2" size="2" value="5" onchange="calcUtil()"/><br/>
Number of resources: <input id="4" name="rsrc_number" type="text" maxlength="3" size="3" value="50" onchange="calcUtil()"/><br/>
Size of each resource: <input id="5" name="rsrc_size" type="text" maxlength="3" size="3" value="4" onchange="calcUtil()"/><br/>
Expected average resource utilization: <span id="util">82.2</span>%<br/>
</td>
<td><input id="erase_db" type="submit" value="Run" />
<input type="hidden" name="action" value="create" /></td>
</form></tr>
</table>
</div>
{% endif %}

{% else %}
Sorry, You don't have any execute permissions...
{% endif %}

</div>
{% endblock %}
