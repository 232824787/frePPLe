<?xml version="1.0" encoding="UTF-8" ?>
<PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<?PYTHON
from freppledb.execute.export_database import exportfrepple as export_to_database
from freppledb.execute.export_file import exportfrepple as export_to_file
from freppledb.execute.load import loadfrepple
import os

# Create a solver where the plan type are defined by an environment variable
try: plantype = os.environ['PLAN_TYPE']
except KeyError: plantype = 7  # Default is a fully constrained plan
frepple.readXMLdata(
  '''<PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <LOGFILE>%s</LOGFILE>
  <SOLVERS>
    <SOLVER xsi:type="SOLVER_MRP" NAME="MRP" CONSTRAINTS="%s"/>
  </SOLVERS>
  </PLAN>''' % (os.path.join(os.environ['FREPPLE_HOME'],'frepple.log'),plantype), False, False)
?>
  <COMMANDS>
    <VERBOSE>true</VERBOSE>
    <ABORTONERROR>true</ABORTONERROR>
    <COMMAND xsi:type="COMMAND_SIZE" />
    <COMMAND xsi:type="COMMAND_PYTHON" CMDLINE="loadfrepple()" />
    <COMMAND xsi:type="COMMAND_SIZE" />
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="Netting orders from forecast" xsi:type="SOLVER_FORECAST" VERBOSE="false"/>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SOLVE">
        <SOLVER xsi:type="SOLVER_MRP" NAME="MRP" VERBOSE="false" MAXPARALLEL="2"/>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SIZE" />
    <COMMAND xsi:type="COMMAND_PYTHON" CMDLINE="export_to_database()" />
    <!--
    <COMMAND xsi:type="COMMAND_PYTHON" CMDLINE="export_to_file()" />
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.1.xml" />
    <COMMAND xsi:type="COMMAND_ERASE" MODE="model" />
    <COMMAND xsi:type="COMMAND_SIZE" />
    -->
  </COMMANDS>
</PLAN>
