# file : $URL$
# revision : $LastChangedRevision$  $LastChangedBy$
# date : $LastChangedDate$

#
# These are the extra settings to add to your apache httpd.conf configuration
# file for deploying frePPLe as a django application.
# See the Django website http://www.djangoproject.com/documentation/modpython/
# for more information.
#

#
# !!! IMPORTANT !!!
# YOU WILL NEED TO UPDATE THIS FILE MANUALLY TO MATCH YOUR ENVIRONMENT.
# Different linux distributions use slightly different ways of configuring the
# apache web server.
# Also, the configuration below should be seen as a guideline / sample only.
# Your needs and/or practices may justify a different setup.
#

#
# !!! IMPORTANT !!!
# USE THE APACHE NON-THREADED, PRE-FORKING WORKER MODULE.
#

#
# !!! IMPORTANT !!!
# This configuration file uses the same apache process to serve both the 
# dynamic pages as well as the static pages.
# To make the best of your resources it is recommended to serve the static
# pages from a seperate web server (either lighttpd or a tuned-down apache
# instance): the apache processes to serve dynamic pages consumes 20-30 MB
# per worker process, while a lightweight server for the static content can 
# serve these pages faster and with less memory.
#

## Load the following apache modules, if not loaded already.
#LoadModule deflate_module modules/mod_deflate.so
#LoadModule mime_module modules/mod_mime.so
#LoadModule python_module modules/mod_python.so
#LoadModule alias_module modules/mod_alias.so
#LoadModule expires_module modules/mod_expires.so
#LoadModule authz_host_module modules/mod_authz_host.so

## Uncomment the next line to enable the HTTPS encryption.
#LoadModule ssl_module modules/mod_ssl.so

## This section is used when you want to use HTTPS encrypted communication.
## Do NOT simply enable the statements below without understanding what they
## exactly mean. Review them carefully and modify according to your needs...

<IfModule ssl_module>
   SSLEngine on
   SSLOptions +StrictRequire
   SSLProtocol all -SSLv2
   SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
   SSLMutex default
   SSLRandomSeed startup builtin
   SSLRandomSeed connect builtin
   SSLSessionCache shm:/home/frepple/workspace/frepple/contrib/django/ssl_cache
   SSLSessionCacheTimeout 600
   SSLPassPhraseDialog builtin
   # Update the next two lines to point to your server certificate and private key.
   # You can create a key pair with e.g. a statement like:
   #     openssl req -new -x509 -nodes -days 3650 -keyout frepple.key -out frepple.crt
   SSLCertificateFile /home/frepple/workspace/frepple/contrib/django/frepple.crt
   SSLCertificateKeyFile /home/frepple/workspace/frepple/contrib/django/frepple.key
   SSLVerifyClient none
   SSLCryptoDevice builtin
   SSLProxyEngine off
</IfModule>

AddDefaultCharset utf-8

SetEnv FREPPLE_HOME /home/frepple/workspace/frepple/bin

<Location "/">
    <IfModule ssl_module>
    SSLRequireSSL
    </IfModule>
    SetHandler python-program
    PythonHandler django.core.handlers.modpython
    # Use the next line for profiling Django
    # PythonHandler django.core.handlers.profiler-hotshot
    # Ensuring a utf-8 compatible locale is used.
    SetEnv LC_ALL en_US.UTF-8
    # Pointing to the django configuration
    SetEnv DJANGO_SETTINGS_MODULE freppledb.settings
    PythonPath "['', '/home/frepple/workspace/frepple/contrib/django/freppledb', '/home/frepple/workspace/frepple/contrib/django/', '/usr/lib/python25.zip', '/usr/lib/python2.5', '/usr/lib/python2.5/plat-linux2', '/usr/lib/python2.5/lib-tk', '/usr/lib/python2.5/lib-dynload', '/usr/lib/python2.5/site-packages', '/usr/lib/python2.5/site-packages/Numeric', '/usr/lib/python2.5/site-packages/dbus', '/usr/lib/python2.5/site-packages/gtk-2.0']"
    #PythonPath "[r'/home/frepple/workspace/frepple/contrib/django/'] + sys.path"
    PythonInterpreter freppledb
    # For best performance on a production server
    PythonAutoReload Off
    PythonDebug Off
    # Compress the data. This setting is optional but highly recommended.
    # The compression drastically reduces the network traffic for the
    # request, while taking up only a little extra overhead on the webserver.
    # A compression ratio of 10 is typically achieved for large reports.
    SetOutputFilter DEFLATE
    # Disable Apache control over expiration
    ExpiresActive Off
</Location>

# Serving static django files
Alias /media/ /home/frepple/workspace/django/django/contrib/admin/media/
<Location /media>
    #AllowOverride None
    Order allow,deny
    Allow from all
    Options -Indexes -FollowSymLinks
    SetHandler None
    # Cache all these static files in the client browser
    ExpiresActive On
    ExpiresDefault "access plus 4 weeks"
    # Compress
    SetOutputFilter DEFLATE
</Location>

# Serving static frepple files
Alias /static/ /home/frepple/workspace/frepple/contrib/django/freppledb/static/
<Location /static>
    #AllowOverride None
    Order allow,deny
    Allow from all
    SetHandler None
    # Cache all these static files in the client browser
    ExpiresActive On
    ExpiresDefault "access plus 4 weeks"
    Options FollowSymLinks -Indexes
    # Compress
    SetOutputFilter DEFLATE
</Location>
