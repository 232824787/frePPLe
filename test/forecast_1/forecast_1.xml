<?xml version="1.0" encoding="UTF-8" ?>
<PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <NAME>Forecast matching test model</NAME>
  <DESCRIPTION>
    This test case test the matching between an actual order and a forecast.
    Different scenarios are being validated:
      - A: match at 'customer'+'item' level
      - B: match at 'item' level
      - C: match at 'parent customer' + 'item' level
      - D: match at 'customer' + 'parent item' level
      - E: match at 'parent customer' + 'parent item' level
  </DESCRIPTION>
  <CURRENT>2007-01-01T00:00:00</CURRENT>
  <COMMANDS>
    <VERBOSE>true</VERBOSE>
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="Netting orders from forecast" xsi:type="SOLVER_FORECAST">
        <VERBOSE>true</VERBOSE>
        <AUTOMATIC>false</AUTOMATIC>
      </SOLVER>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVE">
      <FILENAME>output.1.xml</FILENAME>
    </COMMAND>
  </COMMANDS>
  <CALENDARS>
    <CALENDAR NAME="Weeks" xsi:type="CALENDAR_VOID">
      <BUCKETS>
        <BUCKET START="2007-01-01T00:00:00"/>
        <BUCKET START="2007-02-01T00:00:00"/>
        <BUCKET START="2007-03-01T00:00:00"/>
      </BUCKETS>
    </CALENDAR>
  </CALENDARS>

  <!-- Define a hierarchical tree of customers:
    "grandparent customer"   -> "parent customer" -> "customer"
  -->
  <CUSTOMERS>
    <CUSTOMER NAME="A parent customer">
      <OWNER NAME="A grandparent customer" />
      <MEMBERS>
         <CUSTOMER NAME="A customer"/>
      </MEMBERS>
    </CUSTOMER>
    <CUSTOMER NAME="B parent customer">
      <OWNER NAME="B grandparent customer" />
      <MEMBERS>
         <CUSTOMER NAME="B customer"/>
      </MEMBERS>
    </CUSTOMER>
    <CUSTOMER NAME="C parent customer">
      <OWNER NAME="C grandparent customer" />
      <MEMBERS>
         <CUSTOMER NAME="C customer"/>
      </MEMBERS>
    </CUSTOMER>
    <CUSTOMER NAME="D parent customer">
      <OWNER NAME="D grandparent customer" />
      <MEMBERS>
         <CUSTOMER NAME="D customer"/>
      </MEMBERS>
    </CUSTOMER>
    <CUSTOMER NAME="E parent customer">
      <OWNER NAME="E grandparent customer" />
      <MEMBERS>
         <CUSTOMER NAME="E customer"/>
      </MEMBERS>
    </CUSTOMER>
  </CUSTOMERS>

  <!-- Define a hierarchical tree of items:
    "grandparent item"   -> "parent item" -> "item"
  -->
  <ITEMS>
    <ITEM NAME="A parent item">
      <OWNER NAME="A grandparent item" />
      <MEMBERS>
         <ITEM NAME="A item">
            <OPERATION NAME="A delivery" xsi:type="OPERATION_FIXED_TIME">
              <DURATION>24:00:00</DURATION>
            </OPERATION>
         </ITEM>
      </MEMBERS>
    </ITEM>
    <ITEM NAME="B parent item">
      <OWNER NAME="B grandparent item" />
      <MEMBERS>
         <ITEM NAME="B item">
            <OPERATION NAME="B delivery" xsi:type="OPERATION_FIXED_TIME">
              <DURATION>24:00:00</DURATION>
            </OPERATION>
         </ITEM>
      </MEMBERS>
    </ITEM>
    <ITEM NAME="C parent item">
      <OWNER NAME="C grandparent item" />
      <MEMBERS>
         <ITEM NAME="C item">
            <OPERATION NAME="C delivery" xsi:type="OPERATION_FIXED_TIME">
              <DURATION>24:00:00</DURATION>
            </OPERATION>
         </ITEM>
      </MEMBERS>
    </ITEM>
    <ITEM NAME="D parent item">
      <OWNER NAME="D grandparent item" />
      <MEMBERS>
         <ITEM NAME="D item">
            <OPERATION NAME="D delivery" xsi:type="OPERATION_FIXED_TIME">
              <DURATION>24:00:00</DURATION>
            </OPERATION>
         </ITEM>
      </MEMBERS>
    </ITEM>
    <ITEM NAME="E parent item">
      <OWNER NAME="E grandparent item" />
      <MEMBERS>
         <ITEM NAME="E item">
            <OPERATION NAME="E delivery" xsi:type="OPERATION_FIXED_TIME">
              <DURATION>24:00:00</DURATION>
            </OPERATION>
         </ITEM>
      </MEMBERS>
    </ITEM>
  </ITEMS>

  <!-- Case A: Match at 'customer' and 'item' level. -->
  <DEMANDS>
    <!-- Forecasts -->
    <DEMAND NAME="A forecast" xsi:type="DEMAND_FORECAST">
      <ITEM NAME="A item" />
      <CUSTOMER NAME="A customer" />
      <CALENDAR NAME="Weeks" />
      <BUCKETS>
        <BUCKET>
          <START>2007-01-01T00:00:00</START>
          <END>2007-02-01T00:00:00</END>
          <QUANTITY>100</QUANTITY>
        </BUCKET>
      </BUCKETS>
    </DEMAND>
    <DEMAND NAME="A forecast not selected" xsi:type="DEMAND_FORECAST">
      <DESCRIPTION>This forecast is not selected because lower level
      matches take precedence.</DESCRIPTION>
      <ITEM NAME="A parent item" />
      <CUSTOMER NAME="A parent customer" />
      <CALENDAR NAME="Weeks" />
    </DEMAND>
    <!-- Actual orders -->
    <DEMAND NAME="A order">
      <ITEM NAME="A item"/>
      <CUSTOMER NAME="A customer"/>
      <QUANTITY>10</QUANTITY>
      <DUE>2007-01-02T00:00:00</DUE>
    </DEMAND>
  </DEMANDS>

  <!-- Case B: Match at 'item' level. -->
  <DEMANDS>
    <!-- Forecasts -->
    <DEMAND NAME="B forecast" xsi:type="DEMAND_FORECAST">
      <ITEM NAME="B item" />
      <CALENDAR NAME="Weeks" />
      <BUCKETS>
        <BUCKET>
          <START>2007-01-01T00:00:00</START>
          <END>2007-02-01T00:00:00</END>
          <QUANTITY>100</QUANTITY>
        </BUCKET>
      </BUCKETS>
    </DEMAND>
    <!-- Actual orders -->
    <DEMAND NAME="B order 1">
      <ITEM NAME="B item"/>
      <CUSTOMER NAME="B customer"/>
      <QUANTITY>10</QUANTITY>
      <DUE>2007-01-02T00:00:00</DUE>
    </DEMAND>
    <DEMAND NAME="B order 2">
      <ITEM NAME="B item"/>
      <QUANTITY>10</QUANTITY>
      <DUE>2007-01-02T00:00:00</DUE>
    </DEMAND>
  </DEMANDS>

  <!-- Case C: Match at 'parent customer' + 'item' level. -->
  <DEMANDS>
    <!-- Forecasts -->
    <DEMAND NAME="C forecast" xsi:type="DEMAND_FORECAST">
      <ITEM NAME="C item" />
      <CUSTOMER NAME="C parent customer" />
      <CALENDAR NAME="Weeks" />
      <BUCKETS>
        <BUCKET>
          <START>2007-01-01T00:00:00</START>
          <END>2007-02-01T00:00:00</END>
          <QUANTITY>100</QUANTITY>
        </BUCKET>
      </BUCKETS>
    </DEMAND>
    <DEMAND NAME="C forecast not selected" xsi:type="DEMAND_FORECAST">
      <DESCRIPTION>This forecast is not selected since we search higher
      levels in the customer dimension first.
      Switching the flag Customer_Then_Item_Hierarchy to false will
      flip the search order around.</DESCRIPTION>
      <ITEM NAME="C parent item" />
      <CUSTOMER NAME="C customer" />
      <CALENDAR NAME="Weeks" />
      <BUCKETS>
        <BUCKET>
          <START>2007-01-01T00:00:00</START>
          <END>2007-02-01T00:00:00</END>
          <QUANTITY>100</QUANTITY>
        </BUCKET>
      </BUCKETS>
    </DEMAND>
    <!-- Actual orders -->
    <DEMAND NAME="C order">
      <ITEM NAME="C item"/>
      <CUSTOMER NAME="C customer"/>
      <QUANTITY>10</QUANTITY>
      <DUE>2007-01-02T00:00:00</DUE>
    </DEMAND>
  </DEMANDS>

  <!-- Case D: Match at 'customer' + 'parent item' level. -->
  <DEMANDS>
    <!-- Forecasts -->
    <DEMAND NAME="D forecast" xsi:type="DEMAND_FORECAST">
      <ITEM NAME="D parent item" />
      <CUSTOMER NAME="D customer" />
      <CALENDAR NAME="Weeks" />
      <BUCKETS>
        <BUCKET>
          <START>2007-01-01T00:00:00</START>
          <END>2007-02-01T00:00:00</END>
          <QUANTITY>100</QUANTITY>
        </BUCKET>
      </BUCKETS>
    </DEMAND>
    <!-- Actual orders -->
    <DEMAND NAME="D order">
      <ITEM NAME="D item"/>
      <CUSTOMER NAME="D customer"/>
      <QUANTITY>10</QUANTITY>
      <DUE>2007-01-02T00:00:00</DUE>
    </DEMAND>
  </DEMANDS>

  <!-- Case E: Match at 'parent customer' + 'parent item' level. -->
  <DEMANDS>
    <!-- Forecasts -->
    <DEMAND NAME="E forecast" xsi:type="DEMAND_FORECAST">
      <ITEM NAME="E parent item" />
      <CUSTOMER NAME="E parent customer" />
      <CALENDAR NAME="Weeks" />
      <BUCKETS>
        <BUCKET>
          <START>2007-01-01T00:00:00</START>
          <END>2007-02-01T00:00:00</END>
          <QUANTITY>100</QUANTITY>
        </BUCKET>
      </BUCKETS>
    </DEMAND>
    <!-- Actual orders -->
    <DEMAND NAME="E order">
      <ITEM NAME="E item"/>
      <CUSTOMER NAME="E customer"/>
      <QUANTITY>10</QUANTITY>
      <DUE>2007-01-02T00:00:00</DUE>
    </DEMAND>
  </DEMANDS>
</PLAN>
