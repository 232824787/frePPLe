<?xml version="1.0" encoding="UTF-8" ?>

<!-- Define a Python function -->
<?python
import csv, frepple
def readcsv():
  x = [ '<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n<items>' ]
  for row in csv.reader(open("input.1.csv", "rb")):
    # Skip empty lines
    if len(row) == 0: continue
    # Complete incomplete lines
    for missing in range(len(row),3): row.append('none')
    try:
      # Skip comment lines
      if row[0].startswith('#'): continue
      # Add a line to the XML output list
      x.append('<item name="%s" description="%s" category="%s"/>' % (row[0],row[1],row[2]))
    except:
      print "error"
  x.append('</items>\n</plan>')
  # Post the XML to Frepple
  frepple.readXMLdata('\n'.join(x),False,False)
?>

<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <current>2007-01-01T00:00:00</current>
  <commands>
    <verbose>true</verbose>
    <command xsi:type="command_python" cmdline="readcsv()" />
    <command xsi:type="command_save" filename="output.1.xml" />
  </commands>
</plan>
