<?xml version="1.0" encoding="UTF-8" ?>
<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <name>command Test</name>
  <description>
    In this test commands are being run in parallel and in sequence. The proper
    branching and merging of the tasks is verified, and the behavior in case of
    errors. The system commands used in this test are crafted such that they
    work both in *nix shells and windows command shell.
  </description>
  <commands>
    <verbose>true</verbose>
    <abortonerror>true</abortonerror>
    <command xsi:type="command_system" cmdline="echo START >output.1.xml" />
    <!-- Creating a bunch of parallel tasks which merge at the end. -->
    <command xsi:type="command_system"
      cmdline="echo TEST 1: Creating parallel tasks and merge them >>output.1.xml" />
    <command xsi:type="command_list" maxparallel="100">
      <command xsi:type="command_list">
        <command xsi:type="command_system"
          cmdline="sleep 1 &amp;&amp; echo  A after 1 second >>output.1.xml" />
        <command xsi:type="command_system"
          cmdline="sleep 1 &amp;&amp; echo  A after 2 seconds >>output.1.xml" />
        <command xsi:type="command_system"
          cmdline="sleep 3 &amp;&amp; echo  A after 5 seconds >>output.1.xml" />
      </command>
      <command xsi:type="command_system"
        cmdline="sleep 3 &amp;&amp; echo  B after 3 seconds >>output.1.xml" />
      <command xsi:type="command_list">
        <command xsi:type="command_system"
          cmdline="sleep 4 &amp;&amp; echo  C after 4 seconds >>output.1.xml" />
        <command xsi:type="command_system"
          cmdline="sleep 2 &amp;&amp; echo  C after 6 seconds >>output.1.xml" />
      </command>
    </command>
    <!-- Creating a command list that continues in case of an error. -->
    <command xsi:type="command_system"
      cmdline="echo TEST 2: Command list that continues on error >>output.1.xml" />
    <command xsi:type="command_list">
      <abortonerror>false</abortonerror>
      <command xsi:type="command_system"
        cmdline="echo  before failure >>output.1.xml" />
      <command xsi:type="command_system" cmdline="false" />
      <command xsi:type="command_system"
        cmdline="echo  after failure >>output.1.xml" />
    </command>
    <!-- Creating a command list that aborts in case of an error. -->
    <command xsi:type="command_system"
      cmdline="echo TEST 3: Command list that aborts on error >>output.1.xml" />
    <command xsi:type="command_list">
      <abortonerror>true</abortonerror>
      <command xsi:type="command_system"
        cmdline="echo  before failure >>output.1.xml" />
      <command xsi:type="command_system" cmdline="false" />
      <command xsi:type="command_system"
        cmdline="echo  after failure >>output.1.xml" />
    </command>
    <!-- Creating some parallel tasks one of which fails. -->
    <command xsi:type="command_system"
      cmdline="echo TEST 4: Parallel commands with failing branch >>output.1.xml" />
    <command xsi:type="command_list">
      <!-- value has no impact on execution any more! -->
      <abortonerror>false</abortonerror>
      <maxparallel>100</maxparallel>
      <command xsi:type="command_system"
        cmdline="echo  task 1 okay >>output.1.xml" />
      <command xsi:type="command_system"
        cmdline="sleep 1 &amp;&amp; echo  task 2 failing >>output.1.xml &amp;&amp; false" />
      <command xsi:type="command_system"
        cmdline="sleep 2 &amp;&amp; echo  task 3 okay >>output.1.xml" />
    </command>
    <command xsi:type="command_system" cmdline="echo END >>output.1.xml" />
  </commands>
</plan>
