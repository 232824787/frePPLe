<?xml version="1.0" encoding="UTF-8" ?>
<PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <NAME>Deletion test model</NAME>
  <DESCRIPTION>
    This model tests how static and dynamic entities can be deleted from the
    model. The tests loads a model, plans it, and then runs a number of delete
    commands. After each delete command, the model is replanned and saved. Since
    planning and saving a model requires going over all objects in memory, any
    dangling pointers likely to surface soon and crash the application. Ha...
  </DESCRIPTION>
  <COMMANDS>
    <VERBOSE>true</VERBOSE>
    <ABORTONERROR>true</ABORTONERROR>

    <!--
      Starting position...
    -->
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.1.xml" />
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="MRP" xsi:type="SOLVER_MRP" CONSTRAINTS="0" />
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVEPLAN" FILENAME="output.2.xml" />

    <!--
      Now we delete the plan and then recreate it. The plan summary
      and static plan should be identical.
    -->
    <COMMAND xsi:type="COMMAND_ERASE" MODE="plan" />
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.3.xml" />
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="MRP" />
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVEPLAN" FILENAME="output.4.xml" />
    <COMMAND xsi:type="COMMAND_ERASE" MODE="plan" />

    <!--
      Now we delete a location. Its sublocations will get a new parent.
      References to the location are being removed from buffers and
      resources.
      Note the use of a <![CDATA[ ... ]]> section to pass the enclosed
      data literally to the XML parser. Otherwise we'ld have to escape the
      special XML characters < > "    See below for examples without a
      CDATA section
    -->
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        <![CDATA[
				<PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<LOCATIONS>
						<LOCATION NAME="Location 1" ACTION="R"/>
					</LOCATIONS>
				</PLAN>
			]]>
      </DATA>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.5.xml" />

    <!--
      Now we delete a customer. References to it will be removed from demands.
      Also delete a flow and a load. References to them from operations and removes any
      existing flowplans and loadplans.
    -->
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="MRP" />
    </COMMAND>
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        <![CDATA[
				<PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<CUSTOMERS>
						<CUSTOMER NAME="Customer 1" ACTION="R"/>
					</CUSTOMERS>
				</PLAN>
			]]>
      </DATA>
    </COMMAND>
    <!--  @todo Flow and load deletion not working yet...
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        <![CDATA[
				<PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
   		  <FLOWS>
				  <FLOW ACTION="R">
        		<BUFFER NAME="buffer B"/>
					  <OPERATION NAME="make item 1"/>
				  </FLOW>
				</FLOWS>
   		  <LOADS>
				  <LOAD ACTION="R">
        		<RESOURCE NAME="assemble"/>
					  <OPERATION NAME="make item 1"/>
				  </LOAD>
				</LOADS>
				</PLAN>
			]]>
      </DATA>
    </COMMAND>
    -->
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.6.xml" />

    <!--
      Now we delete an operationplan.
      IMPORTANT: Because we rely on the operationplan id to find the
      operationplan to delete, a change in the solver algorithm might
      require this test to be updated. The ID of the operationplan to
      delete is different...
    -->
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        <![CDATA[
        <PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <OPERATION_PLANS>
            <OPERATION_PLAN ID="39" ACTION="R"/>
          </OPERATION_PLANS>
        </PLAN>
			  ]]>
      </DATA>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.7.xml" />

    <!--
      Now we delete a resource. Operationsplans are being deleted of
      operations that are loading the resource. The loads are also deleted.
    -->
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="MRP" />
    </COMMAND>
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        &lt;PLAN&gt; &lt;RESOURCES&gt; &lt;RESOURCE NAME=&quot;assemble&quot;
        ACTION=&quot;R&quot;/&gt; &lt;/RESOURCES&gt; &lt;/PLAN&gt;
      </DATA>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="MRP" />
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVEPLAN" FILENAME="output.8.xml" />

    <!--
      Now we delete a buffer. Operationsplans are being deleted of
      operations that are consuming or producing material from it. The flows
      are also deleted.
    -->
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        &lt;PLAN&gt; &lt;BUFFERS&gt; &lt;BUFFER NAME=&quot;buffer A&quot;
        ACTION=&quot;R&quot;/&gt; &lt;/BUFFERS&gt; &lt;/PLAN&gt;
      </DATA>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="MRP" />
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVEPLAN" FILENAME="output.9.xml" />

    <!--
      Now we delete an operation.
    -->
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        &lt;PLAN&gt; &lt;OPERATIONS&gt; &lt;OPERATION NAME=
        &quot;make item 1&quot; ACTION=&quot;R&quot;/&gt; &lt;/OPERATIONS&gt;
        &lt;/PLAN&gt;
      </DATA>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="MRP" />
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.10.xml" />


    <!--
      Now we delete an item.
    -->
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        &lt;PLAN&gt; &lt;ITEMS&gt; &lt;ITEM NAME=&quot;item 1&quot;
        ACTION=&quot;R&quot;/&gt; &lt;/ITEMS&gt; &lt;/PLAN&gt;
      </DATA>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SOLVE">
      <SOLVER NAME="MRP" />
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.11.xml" />

    <!--
      Now we delete a calendar and a calendar bucket.
    -->
    <COMMAND xsi:type="COMMAND_READXMLSTRING">
      <DATA>
        <![CDATA[
				<PLAN xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<CALENDARS>
						 <CALENDAR NAME="assembly capacity" ACTION="R"/>
						 <CALENDAR NAME="months" xsi:type="CALENDAR_VOID">
							<BUCKETS>
								<BUCKET START="2007-01-01T00:00:00" ACTION="R"/>
								<BUCKET START="2007-05-01T00:00:00" ACTION="R"/>
							</BUCKETS>
						</CALENDAR>
					</CALENDARS>
				</PLAN>
			]]>
      </DATA>
    </COMMAND>
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.12.xml" />

    <!--
      To finish we delete the complete model.
    -->
    <COMMAND xsi:type="COMMAND_ERASE" MODE="model" />
    <COMMAND xsi:type="COMMAND_SAVE" FILENAME="output.13.xml" />

  </COMMANDS>
  <CURRENT>2007-01-01T00:00:00</CURRENT>
  <CALENDARS>
    <CALENDAR_VOID NAME="months">
      <BUCKETS>
        <BUCKET START="2007-01-01T00:00:00" NAME="jan" />
        <BUCKET START="2007-02-01T00:00:00" NAME="feb" />
        <BUCKET START="2007-03-01T00:00:00" NAME="mar" />
        <BUCKET START="2007-04-01T00:00:00" NAME="apr" />
        <BUCKET START="2007-05-01T00:00:00" NAME="may" />
        <BUCKET START="2007-06-01T00:00:00" NAME="jun" />
        <BUCKET START="2007-07-01T00:00:00" NAME="jul" />
        <BUCKET START="2007-08-01T00:00:00" NAME="aug" />
      </BUCKETS>
    </CALENDAR_VOID>
  </CALENDARS>
  <ITEMS>
    <ITEM NAME="item 1">
      <OPERATION NAME="delivery 1" xsi:type="OPERATION_FIXED_TIME">
        <DURATION>P1D</DURATION>
      </OPERATION>
    </ITEM>
  </ITEMS>
  <BUFFERS>
    <BUFFER NAME="buffer 1">
      <ITEM NAME="item 1" />
      <PRODUCING NAME="make item 1" xsi:type="OPERATION_FIXED_TIME">
        <DURATION>P1D</DURATION>
      </PRODUCING>
      <LOCATION NAME="Location 1">
        <OWNER NAME="All places" />
        <MEMBERS>
          <LOCATION NAME="Sublocation 1" />
          <LOCATION NAME="Sublocation 2" />
        </MEMBERS>
      </LOCATION>
    </BUFFER>
    <BUFFER NAME="buffer A">
      <ITEM NAME="component A" />
      <LOCATION NAME="Location 1" />
      <PRODUCING NAME="supply component A" xsi:type="OPERATION_ALTERNATE">
        <ALTERNATES>
          <ALTERNATE>
            <OPERATION NAME="supply component A from supplier 1"
              DURATION="P1D" xsi:type="OPERATION_FIXED_TIME" />
            <PRIORITY>1</PRIORITY>
          </ALTERNATE>
          <ALTERNATE>
            <OPERATION NAME="supply component A from supplier 2"
              DURATION="P2D" xsi:type="OPERATION_FIXED_TIME" />
            <PRIORITY>2</PRIORITY>
          </ALTERNATE>
        </ALTERNATES>
      </PRODUCING>
    </BUFFER>
    <BUFFER NAME="buffer B">
      <ITEM NAME="component B" />
      <LOCATION NAME="Location 1" />
    </BUFFER>
  </BUFFERS>
  <FLOWS>
    <FLOW_START>
      <OPERATION NAME="delivery 1" />
      <BUFFER NAME="buffer 1" />
      <QUANTITY>-1</QUANTITY>
    </FLOW_START>
    <FLOW_END>
      <OPERATION NAME="make item 1" />
      <BUFFER NAME="buffer 1" />
      <QUANTITY>1</QUANTITY>
    </FLOW_END>
    <FLOW_START>
      <OPERATION NAME="make item 1" />
      <BUFFER NAME="buffer A" />
      <QUANTITY>-1</QUANTITY>
    </FLOW_START>
    <FLOW_START>
      <OPERATION NAME="make item 1" />
      <BUFFER NAME="buffer B" />
      <QUANTITY>-1</QUANTITY>
    </FLOW_START>
    <FLOW_END>
      <OPERATION NAME="supply component A from supplier 1" />
      <BUFFER NAME="buffer A" />
      <QUANTITY>1</QUANTITY>
    </FLOW_END>
    <FLOW_END>
      <OPERATION NAME="supply component A from supplier 2" />
      <BUFFER NAME="buffer A" />
      <QUANTITY>1</QUANTITY>
    </FLOW_END>
  </FLOWS>
  <RESOURCES>
    <RESOURCE NAME="assemble">
      <LOCATION NAME="Location 1" />
      <MAXIMUM NAME="assembly capacity" xsi:type="CALENDAR_FLOAT">
        <BUCKETS>
          <BUCKET START="2007-01-01T00:00:00">
            <NAME>all</NAME>
            <VALUE>2</VALUE>
          </BUCKET>
        </BUCKETS>
      </MAXIMUM>
      <LOADS>
        <LOAD>
          <OPERATION NAME="make item 1" />
        </LOAD>
      </LOADS>
    </RESOURCE>
    <RESOURCE NAME="transport">
      <LOCATION NAME="Sublocation 1" />
    </RESOURCE>
  </RESOURCES>
  <DEMANDS>
    <DEMAND NAME="order 1">
      <ITEM NAME="item 1" />
      <PRIORITY>1</PRIORITY>
      <DUE>2007-03-01T00:00:00</DUE>
      <QUANTITY>1</QUANTITY>
      <CUSTOMER NAME="Customer 1" />
    </DEMAND>
    <DEMAND NAME="order 2">
      <ITEM NAME="item 1" />
      <PRIORITY>1</PRIORITY>
      <DUE>2007-02-01T00:00:00</DUE>
      <QUANTITY>1</QUANTITY>
      <CUSTOMER NAME="Customer 1" />
    </DEMAND>
    <DEMAND NAME="order 3">
      <ITEM NAME="item 1" />
      <PRIORITY>1</PRIORITY>
      <DUE>2007-04-01T00:00:00</DUE>
      <QUANTITY>1</QUANTITY>
      <CUSTOMER NAME="Customer 2" />
    </DEMAND>
  </DEMANDS>
</PLAN>
