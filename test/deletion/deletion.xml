<?xml version="1.0" encoding="UTF-8" ?>
<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <name>Deletion test model</name>
  <description>
    This model tests how static and dynamic entities can be deleted from the
    model. The tests loads a model, plans it, and then runs a number of delete
    commands. After each delete command, the model is replanned and saved. Since
    planning and saving a model requires going over all objects in memory, any
    dangling pointers likely to surface soon and crash the application. Ha...
  </description>
  <commands>
    <verbose>true</verbose>
    <abortonerror>true</abortonerror>

    <!--
      Starting position...
    -->
    <command xsi:type="command_save" filename="output.1.xml" />
    <command xsi:type="command_solve">
      <solver name="MRP" xsi:type="solver_mrp" constraints="0" />
    </command>
    <command xsi:type="command_saveplan" filename="output.2.xml" />

    <!--
      Now we delete the plan and then recreate it. The plan summary
      and static plan should be identical.
    -->
    <command xsi:type="command_erase" mode="plan" />
    <command xsi:type="command_save" filename="output.3.xml" />
    <command xsi:type="command_solve">
      <solver name="MRP" />
    </command>
    <command xsi:type="command_saveplan" filename="output.4.xml" />
    <command xsi:type="command_erase" mode="plan" />

    <!--
      Now we delete a location. Its sublocations will get a new parent.
      References to the location are being removed from buffers and
      resources.
      Note the use of a <![CDATA[ ... ]]> section to pass the enclosed
      data literally to the XML parser. Otherwise we'ld have to escape the
      special XML characters < > "    See below for examples without a
      CDATA section
    -->
    <command xsi:type="command_readxmlstring">
      <data>
        <![CDATA[
				<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<locations>
						<location name="Location 1" action="R"/>
					</locations>
				</plan>
			]]>
      </data>
    </command>
    <command xsi:type="command_save" filename="output.5.xml" />

    <!--
      Now we delete a customer. References to it will be removed from demands.
      Also delete a flow and a load. References to them from operations and removes any
      existing flowplans and loadplans.
    -->
    <command xsi:type="command_solve">
      <solver name="MRP" />
    </command>
    <command xsi:type="command_readxmlstring">
      <data>
        <![CDATA[
				<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<customers>
						<customer name="Customer 1" action="R"/>
					</customers>
				</plan>
			]]>
      </data>
    </command>
    <!--  @todo flow and load deletion not working yet...
    <command xsi:type="command_readxmlstring">
      <data>
        <![CDATA[
				<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
   		  <flows>
				  <flow action="R">
        		<buffer name="buffer B"/>
					  <operation name="make item 1"/>
				  </flow>
				</flows>
   		  <loads>
				  <load action="R">
        		<resource name="assemble"/>
					  <operation name="make item 1"/>
				  </load>
				</loads>
				</plan>
			]]>
      </data>
    </command>
    -->
    <command xsi:type="command_save" filename="output.6.xml" />

    <!--
      Now we delete an operationplan.
      IMPORTANT: Because we rely on the operationplan id to find the
      operationplan to delete, a change in the solver algorithm might
      require this test to be updated. The id of the operationplan to
      delete is different...
    -->
    <command xsi:type="command_readxmlstring">
      <data>
        <![CDATA[
        <plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <operation_plans>
            <operation_plan id="27" action="R"/>
          </operation_plans>
        </plan>
			  ]]>
      </data>
    </command>
    <command xsi:type="command_save" filename="output.7.xml" />

    <!--
      Now we delete a resource. operationsplans are being deleted of
      operations that are loading the resource. The loads are also deleted.
    -->
    <command xsi:type="command_solve">
      <solver name="MRP" />
    </command>
    <command xsi:type="command_readxmlstring">
      <data>
        &lt;plan&gt; &lt;resources&gt; &lt;resource name=&quot;assemble&quot;
        action=&quot;R&quot;/&gt; &lt;/resources&gt; &lt;/plan&gt;
      </data>
    </command>
    <command xsi:type="command_solve">
      <solver name="MRP" />
    </command>
    <command xsi:type="command_saveplan" filename="output.8.xml" />

    <!--
      Now we delete a buffer. operationsplans are being deleted of
      operations that are consuming or producing material from it. The flows
      are also deleted.
    -->
    <command xsi:type="command_readxmlstring">
      <data>
        &lt;plan&gt; &lt;buffers&gt; &lt;buffer name=&quot;buffer A&quot;
        action=&quot;R&quot;/&gt; &lt;/buffers&gt; &lt;/plan&gt;
      </data>
    </command>
    <command xsi:type="command_solve">
      <solver name="MRP" />
    </command>
    <command xsi:type="command_saveplan" filename="output.9.xml" />

    <!--
      Now we delete an operation.
    -->
    <command xsi:type="command_readxmlstring">
      <data>
        &lt;plan&gt; &lt;operations&gt; &lt;operation name=
        &quot;make item 1&quot; action=&quot;R&quot;/&gt; &lt;/operations&gt;
        &lt;/plan&gt;
      </data>
    </command>
    <command xsi:type="command_solve">
      <solver name="MRP" />
    </command>
    <command xsi:type="command_save" filename="output.10.xml" />


    <!--
      Now we delete an item.
    -->
    <command xsi:type="command_readxmlstring">
      <data>
        &lt;plan&gt; &lt;items&gt; &lt;item name=&quot;item 1&quot;
        action=&quot;R&quot;/&gt; &lt;/items&gt; &lt;/plan&gt;
      </data>
    </command>
    <command xsi:type="command_solve">
      <solver name="MRP" />
    </command>
    <command xsi:type="command_save" filename="output.11.xml" />

    <!--
      Now we delete a calendar and a calendar bucket.
    -->
    <command xsi:type="command_readxmlstring">
      <data>
        <![CDATA[
				<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
					<calendars>
						 <calendar name="assembly capacity" action="R"/>
						 <calendar name="months" xsi:type="calendar_void">
							<buckets>
								<bucket start="2007-01-01T00:00:00" action="R"/>
								<bucket start="2007-05-01T00:00:00" action="R"/>
							</buckets>
						</calendar>
					</calendars>
				</plan>
			]]>
      </data>
    </command>
    <command xsi:type="command_save" filename="output.12.xml" />

    <!--
      To finish we delete the complete model.
    -->
    <command xsi:type="command_erase" mode="model" />
    <command xsi:type="command_save" filename="output.13.xml" />

  </commands>
  <current>2007-01-01T00:00:00</current>
  <calendars>
    <calendar_void name="months">
      <buckets>
        <bucket start="2007-01-01T00:00:00" name="jan" />
        <bucket start="2007-02-01T00:00:00" name="feb" />
        <bucket start="2007-03-01T00:00:00" name="mar" />
        <bucket start="2007-04-01T00:00:00" name="apr" />
        <bucket start="2007-05-01T00:00:00" name="may" />
        <bucket start="2007-06-01T00:00:00" name="jun" />
        <bucket start="2007-07-01T00:00:00" name="jul" />
        <bucket start="2007-08-01T00:00:00" name="aug" />
      </buckets>
    </calendar_void>
  </calendars>
  <items>
    <item name="item 1">
      <operation name="delivery 1" xsi:type="operation_fixed_time">
        <duration>P1D</duration>
      </operation>
    </item>
  </items>
  <buffers>
    <buffer name="buffer 1">
      <item name="item 1" />
      <producing name="make item 1" xsi:type="operation_fixed_time">
        <duration>P1D</duration>
      </producing>
      <location name="Location 1">
        <owner name="All places" />
        <members>
          <location name="Sublocation 1" />
          <location name="Sublocation 2" />
        </members>
      </location>
    </buffer>
    <buffer name="buffer A">
      <item name="component A" />
      <location name="Location 1" />
      <producing name="supply component A" xsi:type="operation_alternate">
        <alternates>
          <alternate>
            <operation name="supply component A from supplier 1"
              duration="P1D" xsi:type="operation_fixed_time" />
            <priority>1</priority>
          </alternate>
          <alternate>
            <operation name="supply component A from supplier 2"
              duration="P2D" xsi:type="operation_fixed_time" />
            <priority>2</priority>
          </alternate>
        </alternates>
      </producing>
    </buffer>
    <buffer name="buffer B">
      <item name="component B" />
      <location name="Location 1" />
    </buffer>
  </buffers>
  <flows>
    <flow_start>
      <operation name="delivery 1" />
      <buffer name="buffer 1" />
      <quantity>-1</quantity>
    </flow_start>
    <flow_end>
      <operation name="make item 1" />
      <buffer name="buffer 1" />
      <quantity>1</quantity>
    </flow_end>
    <flow_start>
      <operation name="make item 1" />
      <buffer name="buffer A" />
      <quantity>-1</quantity>
    </flow_start>
    <flow_start>
      <operation name="make item 1" />
      <buffer name="buffer B" />
      <quantity>-1</quantity>
    </flow_start>
    <flow_end>
      <operation name="supply component A from supplier 1" />
      <buffer name="buffer A" />
      <quantity>1</quantity>
    </flow_end>
    <flow_end>
      <operation name="supply component A from supplier 2" />
      <buffer name="buffer A" />
      <quantity>1</quantity>
    </flow_end>
  </flows>
  <resources>
    <resource name="assemble">
      <location name="Location 1" />
      <maximum name="assembly capacity" xsi:type="calendar_float">
        <default>1</default>
        <buckets>
          <bucket start="2007-01-01T00:00:00">
            <name>all</name>
            <value>2</value>
          </bucket>
        </buckets>
      </maximum>
      <loads>
        <load>
          <operation name="make item 1" />
        </load>
      </loads>
    </resource>
    <resource name="transport">
      <location name="Sublocation 1" />
    </resource>
  </resources>
  <demands>
    <demand name="order 1">
      <item name="item 1" />
      <priority>1</priority>
      <due>2007-03-01T00:00:00</due>
      <quantity>1</quantity>
      <customer name="Customer 1" />
    </demand>
    <demand name="order 2">
      <item name="item 1" />
      <priority>1</priority>
      <due>2007-02-01T00:00:00</due>
      <quantity>1</quantity>
      <customer name="Customer 1" />
    </demand>
    <demand name="order 3">
      <item name="item 1" />
      <priority>1</priority>
      <due>2007-04-01T00:00:00</due>
      <quantity>1</quantity>
      <customer name="Customer 2" />
    </demand>
  </demands>
</plan>
