<?xml version="1.0" encoding="UTF-8" ?>
<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <name>Forecast test model</name>
  <description>
  This test verifies how actual orders consume from the forecast.
  It shows netting from earlier and later time buckets.
  </description>
  <current>2007-01-01T00:00:00</current>
  <commands>
    <verbose>true</verbose>
    <command xsi:type="command_solve">
      <solver name="Netting orders from forecast" xsi:type="solver_forecast">
        <loglevel>2</loglevel>
        <automatic>false</automatic>
      </solver>
    </command>
    <command xsi:type="command_solve">
      <solver name="MRP" xsi:type="solver_mrp" constraints="0" />
    </command>
    <command xsi:type="command_save">
      <filename>output.1.xml</filename>
    </command>
    <command xsi:type="command_saveplan">
      <filename>output.2.xml</filename>
    </command>
    <command xsi:type="command_erase" mode="model" />
    <command xsi:type="command_save">
      <filename>output.3.xml</filename>
    </command>
    <command xsi:type="command_readxml">
      <filename>output.1.xml</filename>
    </command>
    <command xsi:type="command_readxmlstring">
      <!--
      We need to wrap the second forecast netting round in a xml string.
      That's because the solver created during the initial read is
      deleted with the above erase-command...
      -->
      <data>
        <![CDATA[
				<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
				<commands>
          <command xsi:type="command_solve">
            <solver name="Netting orders from forecast" xsi:type="solver_forecast">
              <loglevel>2</loglevel>
              <automatic>false</automatic>
            </solver>
          </command>
				</commands>
				</plan>
			]]>
      </data>
    </command>
    <command xsi:type="command_save">
      <filename>output.4.xml</filename>
    </command>

  </commands>

  <!--
  This calendar defines how forecast values are disaggregated from the
  -->
  <calendars>
    <calendar name="planningbuckets" xsi:type="calendar_double">
      <buckets>
        <!--
          The value for saturday and sunday is set to zero.
          The forecast is only alllowed on weekdays.
        -->
        <!--
          The weight for a monday is higher than a friday.
          This can be used to model situations where more orders are
          expected to be shipped on monday than on fridays.
          Another usage may be to model cases where a peak of orders is
          expected for delivery near the end of a month.
          The weights model the ordering profile of the customers.
        -->
        <bucket start="2007-01-01T00:00:00" name="Mon Jan 01" value="1.2"/>
        <bucket start="2007-01-02T00:00:00" name="Tue Jan 02" value="1"/>
        <bucket start="2007-01-03T00:00:00" name="Wed Jan 03" value="1"/>
        <bucket start="2007-01-04T00:00:00" name="Thu Jan 04" value="1"/>
        <bucket start="2007-01-05T00:00:00" name="Fri Jan 05" value="0.8"/>
        <bucket start="2007-01-06T00:00:00" name="Sat Jan 06" value="0"/>
        <bucket start="2007-01-07T00:00:00" name="Sun Jan 07" value="0"/>
        <bucket start="2007-01-08T00:00:00" name="Mon Jan 08" value="1.2"/>
        <bucket start="2007-01-09T00:00:00" name="Tue Jan 09" value="1"/>
        <bucket start="2007-01-10T00:00:00" name="Wed Jan 10" value="1"/>
        <bucket start="2007-01-11T00:00:00" name="Thu Jan 11" value="1"/>
        <bucket start="2007-01-12T00:00:00" name="Fri Jan 12" value="0.8"/>
        <bucket start="2007-01-13T00:00:00" name="Sat Jan 13" value="0"/>
        <bucket start="2007-01-14T00:00:00" name="Sun Jan 14" value="0"/>
        <bucket start="2007-01-15T00:00:00" name="Mon Jan 15" value="1.2"/>
        <bucket start="2007-01-16T00:00:00" name="Tue Jan 16" value="1"/>
        <bucket start="2007-01-17T00:00:00" name="Wed Jan 17" value="1"/>
        <bucket start="2007-01-18T00:00:00" name="Thu Jan 18" value="1"/>
        <bucket start="2007-01-19T00:00:00" name="Fri Jan 19" value=".8"/>
        <bucket start="2007-01-20T00:00:00" name="Sat Jan 20" value="0"/>
        <bucket start="2007-01-21T00:00:00" name="Sun Jan 21" value="0"/>
        <!--
          The value of the weekly buckets is set to 5/7 to account for
          the unavailable saturday and sunday.
        -->
        <bucket start="2007-01-22T00:00:00" name="Week 04" value="0.7142857"/>
        <bucket start="2007-01-29T00:00:00" name="Week 05" value="0.7142857"/>
        <bucket start="2007-02-05T00:00:00" name="Week 06" value="0.7142857"/>
        <bucket start="2007-02-12T00:00:00" name="Week 07" value="0.7142857"/>
        <bucket start="2007-02-19T00:00:00" name="Week 08" value="0.7142857"/>
        <bucket start="2007-02-26T00:00:00" name="Week 09" value="0.7142857"/>
        <bucket start="2007-03-05T00:00:00" name="Week 10" value="0.7142857"/>
        <bucket start="2007-03-12T00:00:00" name="Week 11" value="0.7142857"/>
        <bucket start="2007-03-19T00:00:00" name="Week 12" value="0.7142857"/>
        <bucket start="2007-03-26T00:00:00" name="Week 13" value="0.7142857"/>
        <bucket start="2007-04-02T00:00:00" name="Week 14" value="0.7142857"/>
        <bucket start="2007-04-09T00:00:00" name="Week 15" value="0.7142857"/>
        <bucket start="2007-04-16T00:00:00" name="Week 16" value="0.7142857"/>
        <bucket start="2007-04-23T00:00:00" name="Week 17" value="0.7142857"/>
        <bucket start="2007-04-30T00:00:00" name="Week 18" value="0.7142857"/>
        <bucket start="2007-05-07T00:00:00" name="Week 19" value="0.7142857"/>
      </buckets>
    </calendar>
  </calendars>

  <items>
    <item name="Product 1">
      <operation name="delivery 1" xsi:type="operation_fixed_time">
        <duration>P1D</duration>
      </operation>
    </item>
  </items>

  <demands>
    <demand name="Forecast 1" xsi:type="demand_forecast">
      <item name="Product 1" />
      <priority>1</priority>
      <calendar name="planningbuckets" />
      <buckets>
        <bucket>
          <start>2007-01-01T00:00:00</start>
          <end>2007-01-29T00:00:00</end>
          <!-- 4 weeks with 5 working days per week, expecting an average
          forecast of 20 per working day. -->
          <total>400</total>
        </bucket>
      </buckets>
    </demand>
    <demand name="Order 1 for product 1">
       <item name="Product 1"/>
       <due>2007-01-03T00:00:00</due>
       <quantity>90</quantity>
       <priority>1</priority>
    </demand>
    <demand name="Order 2 for product 1">
       <item name="Product 1"/>
       <due>2007-01-03T00:00:00</due>
       <quantity>90</quantity>
       <priority>1</priority>
    </demand>
    <demand name="Order 3 for product 1">
       <item name="Product 1"/>
       <due>2007-01-27T00:00:00</due>
       <quantity>90</quantity>
       <priority>2</priority>
    </demand>
  </demands>
</plan>
