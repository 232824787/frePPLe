<?xml version="1.0" encoding="UTF-8" ?>
<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <name>command Test</name>
  <description>
    In this test the expansion of environment variables is tested.
    The expansion is handled in the frepple code, and is therefore transparant
    across different platforms.
  </description>
  <commands>
    <abortonerror>false</abortonerror>
    <verbose>true</verbose>
    <command xsi:type="command_system" cmdline="echo START >output.1.xml" />

    <!-- Variable VAR2 expands to nothing since it is undefined. -->
    <command xsi:type="command_setenv" variable="VAR1" value="*${VAR2}*" />

    <!-- Define a variable. -->
    <command xsi:type="command_setenv" variable="VAR2" value="VAL" />

    <!-- Defining a variable depending on the previous one. -->
    <command xsi:type="command_setenv" variable="VAR3" value="*${VAR2}*" />

    <!-- Showing the variables in a shell command. Note that we expand the variable before the
         the shell does. -->
    <command xsi:type="command_system" cmdline="echo -${VAR1}-${VAR2}-${VAR3}- >>output.1.xml" />

    <!-- Showing the variables in a python command. -->
    <command xsi:type="command_python" cmdline="print '${VAR1} ${VAR2} ${VAR3}'" />
    <!-- Note that the ptyhon os.environ dictionary is only updated if the SETENV command
         is executed *BEFORE* the loadLIBRARY command!
    -->
    <command xsi:type="command_python" cmdline="import os" />
    <command xsi:type="command_python" cmdline="print os.environ['VAR2']" />

    <!-- Some invalid examples of usage of expansion. -->
    <command xsi:type="command_setenv" variable="VAR4" value="${VAR2" />
    <command xsi:type="command_setenv" variable="VAR5" value="${}" />
    <command xsi:type="command_setenv" variable="VAR6" value="}" />
    <command xsi:type="command_system" cmdline="echo -${VAR4}-${VAR5}-${VAR6}- >>output.1.xml" />

    <!-- Updating existing environment variables. -->
    <!--
    <command xsi:type="command_system" cmdline="echo ${PATH}" />
    <command xsi:type="command_setenv" variable="PATH" value="." />
    <command xsi:type="command_system" cmdline="echo %PATH%" />
    -->

    <!--
      Variables are not expanded for every field.
      Only the following fields are being expanded:
        - command_setenv: field VAL
        - command_system: field cmdline
        - command_python: fields cmdline and filename
        - command_readxmlFILE: field filename
        - command_if: field condition
        - command_loadlib: field filename
        - command_save: field filename
        - command_saveplan: field filename
        - command_readxmlURL: field URL
      An examples of each is given below.
    -->
    <!--
    <command xsi:type="command_readxmlURL" URL="${variable}" />
    <command xsi:type="command_system" cmdline="${variable}" />
    <command xsi:type="command_python" filename="${variable}" />
    <command xsi:type="command_python" cmdline="${variable}" />
    <command xsi:type="command_setenv" variable="var" VAL="${variable}" />
    <command xsi:type="command_save" filename="${variable}" />
    <command xsi:type="command_saveplan" filename="${variable}" />
    <command xsi:type="command_loadlib" filename="${variable}" />
    <command xsi:type="command_if" condition="${variable}">
    -->

    <command xsi:type="command_system" cmdline="echo END >>output.1.xml" />

  </commands>
</plan>
